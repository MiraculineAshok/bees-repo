<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interviewer Dashboard - Bees Interview Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            color: #000000;
            line-height: 1.6;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #000000;
            color: white;
            padding: 1.5rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 0 1.5rem 2rem;
            border-bottom: 1px solid #333333;
            margin-bottom: 1rem;
        }

        .sidebar-header h2 {
            color: #ffffff;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .sidebar-nav {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 0.25rem;
        }

        .nav-link {
            display: block;
            padding: 0.75rem 1.5rem;
            color: #cccccc;
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .nav-link:hover,
        .nav-link.active {
            background: #333333;
            color: white;
            border-left-color: #ffffff;
        }

        .nav-link i {
            margin-right: 0.75rem;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 2rem;
        }

        .header {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #000000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .home-link {
            color: #000;
            text-decoration: none;
            margin-right: 1rem;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .home-link:hover {
            background-color: #f0f0f0;
            text-decoration: none;
        }

        .header h1 {
            color: #000;
            font-size: 2rem;
            font-weight: 700;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            border: none;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #000;
            color: white;
        }

        .btn-primary:hover {
            background: #333;
        }

        .btn-sm {
            padding: 0.3rem 0.6rem;
            font-size: 0.8rem;
        }

        /* Content Tabs */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            border-left: 4px solid #000;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #000;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .section-card {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            border: 1px solid #000;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #000;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }

        .table-container {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .table th, .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background: #f8f8f8;
            font-weight: 600;
            color: #000;
        }

        /* Compact table styling for edit functionality */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .data-table th,
        .data-table td {
            padding: 0.5rem 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            vertical-align: middle;
        }

        .data-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .data-table tr:hover {
            background: #f9fafb;
        }

        .data-table tr.editing {
            background: #fef3c7;
        }

        /* Icon buttons */
        .icon-btn {
            background: none;
            border: none;
            padding: 0.25rem;
            margin: 0 0.125rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
        }

        .icon-btn:hover {
            background: #f3f4f6;
            transform: scale(1.1);
        }

        .edit-btn {
            color: #2563eb;
        }

        .edit-btn:hover {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .delete-btn {
            color: #dc2626;
        }

        .delete-btn:hover {
            background: #fef2f2;
            color: #b91c1c;
        }

        .save-btn {
            color: #059669;
        }

        .save-btn:hover {
            background: #d1fae5;
            color: #047857;
        }

        .cancel-btn {
            color: #6b7280;
        }

        .cancel-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }

        /* Edit form styling */
        .edit-form {
            display: none;
        }

        .edit-form.active {
            display: block;
        }

        .edit-input {
            width: 100%;
            padding: 0.25rem 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.85rem;
            background: white;
        }

        .edit-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }

        .edit-select {
            width: 100%;
            padding: 0.25rem 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.85rem;
            background: white;
        }

        /* Bulk edit controls */
        .bulk-edit-controls {
            display: none;
            padding: 1rem;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
            align-items: center;
            gap: 1rem;
        }

        .bulk-edit-controls.active {
            display: flex;
        }

        .bulk-edit-info {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .bulk-edit-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Checkbox styling */
        .row-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        /* Modal styling for bulk edit */
        .bulk-edit-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .bulk-edit-modal.active {
            display: flex;
        }

        .bulk-edit-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .bulk-edit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .bulk-edit-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
        }

        .bulk-edit-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-weight: 500;
            color: #374151;
            font-size: 0.875rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.875rem;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }

        .bulk-edit-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
            border: none;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .table tbody tr:hover {
            background: #f5f5f5;
        }

        .question-bank-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .question-bank-list {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #000;
            border-radius: 5px;
            padding: 1rem;
            background: #fdfdfd;
        }

        .question-item {
            padding: 0.75rem 0;
            border-bottom: 1px dashed #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .question-item:last-child {
            border-bottom: none;
        }

        .question-text {
            flex-grow: 1;
            margin-right: 1rem;
            color: #000;
        }

        .favorite-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            color: #ccc;
            transition: color 0.2s ease;
        }

        .favorite-btn.favorited {
            color: gold;
        }

        .favorite-btn:hover {
            color: orange;
        }

               .loading, .empty-state {
                   text-align: center;
                   padding: 2rem;
                   color: #666;
               }

               /* Detail Panel Styles */
               .detail-panel {
                   position: fixed;
                   top: 0;
                   right: -400px;
                   width: 400px;
                   height: 100vh;
                   background: white;
                   box-shadow: -2px 0 10px rgba(0,0,0,0.1);
                   z-index: 1001;
                   transition: right 0.3s ease;
                   overflow-y: auto;
               }

               .detail-panel.active {
                   right: 0;
               }

               .detail-overlay {
                   position: fixed;
                   top: 0;
                   left: 0;
                   width: 100%;
                   height: 100%;
                   background: rgba(0,0,0,0.5);
                   z-index: 1000;
                   opacity: 0;
                   visibility: hidden;
                   transition: all 0.3s ease;
               }

               .detail-overlay.active {
                   opacity: 1;
                   visibility: visible;
               }

               .detail-panel-header {
                   background: #000000;
                   color: white;
                   padding: 1rem;
                   display: flex;
                   justify-content: space-between;
                   align-items: center;
                   border-bottom: 1px solid #333;
               }

               .detail-panel-header h3 {
                   margin: 0;
                   font-size: 1.2rem;
               }

               .detail-panel-close {
                   background: none;
                   border: none;
                   color: white;
                   font-size: 1.5rem;
                   cursor: pointer;
                   padding: 0;
                   width: 30px;
                   height: 30px;
                   display: flex;
                   align-items: center;
                   justify-content: center;
               }

               .detail-panel-content {
                   padding: 1.5rem;
               }

               .detail-section {
                   margin-bottom: 2rem;
               }

               .detail-section-title {
                   font-size: 1.1rem;
                   font-weight: 600;
                   color: #000000;
                   margin-bottom: 1rem;
                   padding-bottom: 0.5rem;
                   border-bottom: 2px solid #000000;
               }

               .detail-item {
                   display: flex;
                   justify-content: space-between;
                   align-items: flex-start;
                   padding: 0.75rem 0;
                   border-bottom: 1px solid #eee;
               }

               .detail-label {
                   font-weight: 600;
                   color: #666;
                   min-width: 120px;
               }

               .detail-value {
                   color: #000000;
                   text-align: right;
                   flex: 1;
               }

               .question-answer-item {
                   background: #f8f9fa;
                   padding: 1rem;
                   margin-bottom: 1rem;
                   border-radius: 5px;
                   border-left: 4px solid #000000;
               }

               .question-answer-item p {
                   margin: 0.5rem 0;
                   color: #000000;
               }
               
               .question-header, .answer-section {
                   display: flex;
                   justify-content: space-between;
                   align-items: flex-start;
                   margin-bottom: 0.5rem;
               }
               
               .question-header p, .answer-section p {
                   flex: 1;
                   margin: 0;
                   margin-right: 0.5rem;
               }
               
               .question-text-display, .answer-text-display {
                   word-wrap: break-word;
               }
               
               .question-edit-input, .answer-edit-input {
                   width: 100%;
                   padding: 0.5rem;
                   border: 1px solid #d1d5db;
                   border-radius: 4px;
                   font-size: 0.9rem;
                   margin-bottom: 0.5rem;
               }
               
               .edit-actions {
                   display: flex;
                   gap: 0.5rem;
                   margin-top: 0.5rem;
               }
               
               .photo-gallery {
                   display: flex;
                   flex-wrap: wrap;
                   gap: 0.5rem;
                   margin-top: 0.5rem;
               }
               
               .photo-item {
                   position: relative;
                   display: inline-block;
               }
               
               .photo-item img {
                   width: 80px;
                   height: 80px;
                   object-fit: cover;
                   border-radius: 4px;
                   border: 1px solid #d1d5db;
                   cursor: pointer;
               }

               .answer-image {
                   max-width: 100%;
                   height: auto;
                   border-radius: 5px;
                   cursor: pointer;
                   margin-top: 0.5rem;
               }

               /* Image Modal Styles */
               .image-modal {
                   position: fixed;
                   top: 0;
                   left: 0;
                   width: 100%;
                   height: 100%;
                   background: rgba(0,0,0,0.9);
                   z-index: 2000;
                   display: flex;
                   align-items: center;
                   justify-content: center;
                   opacity: 0;
                   visibility: hidden;
                   transition: all 0.3s ease;
               }

               .image-modal.active {
                   opacity: 1;
                   visibility: visible;
               }

               .image-modal-content {
                   position: relative;
                   max-width: 90%;
                   max-height: 90%;
               }

               .image-modal-content img {
                   max-width: 100%;
                   max-height: 100%;
                   border-radius: 5px;
               }

               .image-modal-close {
                   position: absolute;
                   top: -40px;
                   right: 0;
                   color: white;
                   font-size: 2rem;
                   cursor: pointer;
                   background: rgba(0,0,0,0.5);
                   width: 40px;
                   height: 40px;
                   display: flex;
                   align-items: center;
                   justify-content: center;
                   border-radius: 50%;
               }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #000;
        }

        .form-select, .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #000;
            border-radius: 5px;
            font-size: 1rem;
        }

        .hidden {
            display: none !important;
        }

        /* Compact Filter Toggle Button */
        .btn-filter-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #000000;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .btn-filter-toggle:hover {
            background: #333333;
            transform: translateY(-1px);
        }

        .filter-icon {
            font-size: 1rem;
        }

        .filter-text {
            font-weight: 500;
        }

        /* Filter Panel */
        .filter-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            transition: right 0.3s ease;
            overflow-y: auto;
        }

        .filter-panel.active {
            right: 0;
        }

        .filter-panel-header {
            background: #000000;
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333333;
        }

        .filter-panel-header h3 {
            margin: 0;
            font-size: 1.2rem;
            flex: 1;
        }

        .filter-panel-content {
            padding: 1.5rem;
        }

        /* Filter Panel Overlay - separate from detail panel overlay */
        .filter-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 400px; /* Don't cover the filter panel */
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        .filter-panel-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Filter Panel Sections */
        .filter-panel .filter-section,
        .filter-panel .sort-section,
        .filter-panel .group-by-section {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .filter-panel .filter-section-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #333333;
            font-size: 0.9rem;
        }

        .filter-panel .filter-row {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .filter-panel .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .filter-panel .filter-group label {
            font-size: 0.8rem;
            font-weight: 500;
            color: #555555;
        }

        .filter-panel .form-input,
        .filter-panel .form-select {
            padding: 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.8rem;
            width: 100%;
        }

        .filter-panel .sort-options,
        .filter-panel .group-by-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .filter-panel .sort-option {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .filter-panel .group-by-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-panel .group-by-option label {
            font-size: 0.8rem;
            cursor: pointer;
            margin: 0;
        }

        .filter-panel .filter-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #dee2e6;
        }

        .filter-panel .btn-filter,
        .filter-panel .btn-clear,
        .filter-panel .btn-export,
        .filter-panel .btn {
            width: 100%;
            padding: 0.75rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s;
        }

        /* Enhanced Filter Styles */
        .controls-panel {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid #dee2e6;
        }

        .filter-section {
            margin-bottom: 1.5rem;
        }

        .filter-section-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #495057;
            font-size: 1rem;
            border-bottom: 2px solid #007bff;
            padding-bottom: 0.25rem;
        }

        .filter-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #495057;
            font-size: 0.875rem;
        }

        .filter-group select,
        .filter-group input {
            padding: 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.875rem;
            background: white;
        }

        .filter-group input[type="text"] {
            min-width: 200px;
        }

        .filter-group input[type="number"] {
            min-width: 100px;
        }

        /* Sort Section */
        .sort-section {
            background: #fff3cd;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .sort-options {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .sort-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sort-option select {
            padding: 0.25rem 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.875rem;
            min-width: 150px;
        }

        /* Group By Section */
        .group-by-section {
            background: #e9ecef;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .group-by-options {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .group-by-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .group-by-option input[type="radio"] {
            margin: 0;
        }

        .group-by-option label {
            margin: 0;
            font-size: 0.875rem;
            cursor: pointer;
        }

        /* Action Buttons */
        .filter-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn-filter {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s;
        }

        .btn-filter:hover {
            background: #0056b3;
        }

        .btn-clear {
            background: #6c757d;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s;
        }

        .btn-clear:hover {
            background: #545b62;
        }

        .btn-export {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s;
        }

        .btn-export:hover {
            background: #1e7e34;
        }

        /* Results Summary */
        .results-summary {
            background: #d1ecf1;
            padding: 0.75rem 1rem;
            border-radius: 4px;
            margin-top: 1rem;
            font-size: 0.875rem;
            color: #0c5460;
        }

        .results-summary strong {
            color: #000000;
        }

        /* Right-align filter panel action buttons */
        .filter-actions { display: flex; justify-content: flex-end; gap: 8px; }
    </style>
</head>
<body>
    <script>
        // Ensure global handler exists before any inline onclick runs
        window.showSection = window.showSection || function(sectionName) {
            try {
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                const sec = document.getElementById(sectionName + '-section');
                if (sec) sec.classList.add('active');
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                const nav = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
                if (nav) nav.classList.add('active');
                const titles = { interviews: 'My Interviews', questions: 'Question Analysis' };
                const t = document.getElementById('page-title');
                if (t) t.textContent = titles[sectionName] || '';
                const url = new URL(window.location);
                url.searchParams.set('tab', sectionName);
                window.history.replaceState({}, '', url);
            } catch (e) {
                // no-op
            }
        };

        // Provide globals for header buttons to avoid ReferenceError, with lightweight UIs
        window.openAddQuestionModal = window.openAddQuestionModal || async function() {
            try {
                const question = prompt('Enter question');
                if (!question) return;
                const category = prompt('Enter category (e.g., English)') || 'General';
                const res = await fetch('/api/question-bank', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ question, category }) });
                const json = await res.json();
                if (!res.ok || !json.success) throw new Error(json.error || 'Add failed');
                if (typeof loadQuestions === 'function') loadQuestions();
            } catch (e) { console.error(e); alert('Failed to add question'); }
        };
        window.openImportQuestionsModal = window.openImportQuestionsModal || function() {
            let input = document.getElementById('iv-import-file');
            if (!input) {
                input = document.createElement('input');
                input.type = 'file';
                input.id = 'iv-import-file';
                input.accept = '.csv';
                input.style.display = 'none';
                input.addEventListener('change', async () => {
                    const file = input.files && input.files[0];
                    if (!file) return;
                    try {
                        const text = await file.text();
                        const lines = text.split(/\r?\n/).filter(l => l.trim());
                        const parsed = [];
                        for (const line of lines) {
                            const row = (function parseLine(l){ const out=[]; let cur='', q=false; for (let i=0;i<l.length;i++){ const ch=l[i], nx=l[i+1]; if(ch==='"'){ if(q && nx==='"'){ cur+='"'; i++; } else { q=!q; } } else if(ch===',' && !q){ out.push(cur); cur=''; } else { cur+=ch; } } out.push(cur); return out; })(line);
                            if (row.length>=2) parsed.push({ question: row[0].trim(), category: row[1].trim()||'General' });
                            else if (row.length===1) parsed.push({ question: row[0].trim(), category: 'General' });
                        }
                        // bulk import in batches
                        const batchSize = 20;
                        for (let i=0;i<parsed.length;i+=batchSize){
                            const batch = parsed.slice(i,i+batchSize);
                            await fetch('/api/question-bank/bulk-import', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ questions: batch }) });
                        }
                        alert('Import completed');
                        if (typeof loadQuestions === 'function') loadQuestions();
                    } catch (e) { console.error(e); alert('Import failed'); }
                    input.value = '';
                });
                document.body.appendChild(input);
            }
            input.click();
        };
    </script>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Interviewer Dashboard</h2>
            </div>
            <nav>
                <ul class="sidebar-nav">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" onclick="showSection('interviews')">
                            <i>📋</i>
                            My Interviews
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('questions')">
                            <i>❓</i>
                            Question Analysis
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <a href="/" class="home-link">← Home</a>
                    <h1 id="page-title">My Interviews</h1>
                </div>
                <div class="header-actions" style="position:relative;display:flex;gap:8px;align-items:center">
                    <button id="start-interview-btn" class="btn-primary" style="padding:8px 12px;border-radius:6px;border:1px solid #dc2626;background:#dc2626;color:#fff;cursor:pointer" onclick="window.location.href='/interview'">Start Interview</button>
                    <div class="user-info">
                        <div class="user-avatar" id="user-avatar" style="cursor:pointer">I</div>
                        <div id="avatar-menu" style="position:absolute;right:0;top:52px;background:#fff;border:1px solid #e5e7eb;border-radius:8px;box-shadow:0 10px 20px rgba(0,0,0,0.1);display:none;min-width:140px;z-index:10">
                            <button id="logout-btn" style="width:100%;background:#fff;border:none;text-align:left;padding:10px 12px;cursor:pointer">Logout</button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- My Interviews Section -->
            <section id="interviews-section" class="content-section active">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-interviews">0</div>
                        <div class="stat-label">Total Interviews</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completed-interviews">0</div>
                        <div class="stat-label">Completed Interviews</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="in-progress-interviews">0</div>
                        <div class="stat-label">Interviews In Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="favorite-questions">0</div>
                        <div class="stat-label">Favorite Questions</div>
                    </div>
                </div>


                <!-- Interviews Table -->
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">My Interviews</h2>
                        <div class="header-actions">
                            <button class="btn-filter-toggle" onclick="toggleFilterPanel('interviews')" title="Filter & Sort Options">
                                <span class="filter-icon">⚙️</span>
                                <span class="filter-text">Filters</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Results Summary -->
                    <div id="results-summary" class="results-summary" style="display: none;">
                        <strong>0</strong> interviews found
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Student Name</th>
                                    <th>Zeta ID</th>
                                    <th>Session</th>
                                    <th>Status</th>
                                    <th>Verdict</th>
                                    <th>Duration</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="interviews-table-body">
                                <tr><td colspan="8" class="loading">Loading interviews...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Question Analysis Section -->
            <section id="questions-section" class="content-section">
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">Question Analysis</h2>
                        <div class="header-actions">
                            <button class="btn-filter-toggle" onclick="toggleFilterPanel('questions')" title="Filter & Sort Options">
                                <span class="filter-icon">⚙️</span>
                                <span class="filter-text">Filters</span>
                            </button>
                            <button class="btn" onclick="openAddQuestionModal()">Add Question</button>
                            <button class="btn" onclick="openImportQuestionsModal()">Import CSV/XLSX</button>
                        </div>
                    </div>
                    
                    <!-- Results Summary -->
                    <div id="question-results-summary" class="results-summary" style="display: none;">
                        <strong>0</strong> questions found
                    </div>
                    <div id="question-bank-list" class="question-bank-list">
                        <div class="loading">Loading questions...</div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Filter Panel Overlay -->
    <div id="filter-panel-overlay" class="filter-panel-overlay" onclick="closeFilterPanel()"></div>

    <!-- Interview Filter Panel -->
    <div id="filter-panel" class="filter-panel">
        <div class="filter-panel-header">
            <h3>Filter & Sort Options</h3>
            <button class="close-btn" onclick="closeFilterPanel()">✕</button>
        </div>
        <div class="filter-panel-content">
            <!-- Search Section -->
            <div class="filter-section">
                <div class="filter-section-title">🔍 Search & Filter</div>
                <div class="filter-row">
                    <div class="filter-group">
                        <label>Search:</label>
                        <input type="text" id="search-interviews" class="form-input" placeholder="Search by student name, Zeta ID, or session..." onkeyup="applyFilters('interviews')">
                    </div>
                    <div class="filter-group">
                        <label>Status:</label>
                        <select id="status-filter" class="form-select" onchange="applyFilters('interviews')">
                            <option value="">All Statuses</option>
                            <option value="completed">Completed</option>
                            <option value="in_progress">In Progress</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Verdict:</label>
                        <select id="verdict-filter" class="form-select" onchange="applyFilters('interviews')">
                            <option value="">All Verdicts</option>
                            <option value="Tiger">Tiger</option>
                            <option value="Cow">Cow</option>
                            <option value="Cow+">Cow+</option>
                            <option value="Sheep">Sheep</option>
                        </select>
                    </div>
                </div>
                <div class="filter-row">
                    <div class="filter-group">
                        <label>Date From:</label>
                        <input type="date" id="date-from" class="form-input" onchange="applyFilters('interviews')">
                    </div>
                    <div class="filter-group">
                        <label>Date To:</label>
                        <input type="date" id="date-to" class="form-input" onchange="applyFilters('interviews')">
                    </div>
                    <div class="filter-group">
                        <label>Duration (min):</label>
                        <input type="number" id="duration-min" class="form-input" placeholder="Minutes" min="0" onchange="applyFilters('interviews')">
                    </div>
                </div>
            </div>

            <!-- Sort Section -->
            <div class="sort-section">
                <div class="filter-section-title">📊 Sort Options</div>
                <div class="sort-options">
                    <div class="sort-option">
                        <label>Primary Sort:</label>
                        <select id="sort-by" class="form-select" onchange="applyFilters('interviews')">
                            <option value="created_at_desc">Date (Newest First)</option>
                            <option value="created_at_asc">Date (Oldest First)</option>
                            <option value="student_name_asc">Student Name (A-Z)</option>
                            <option value="student_name_desc">Student Name (Z-A)</option>
                            <option value="duration_desc">Duration (Longest First)</option>
                            <option value="duration_asc">Duration (Shortest First)</option>
                            <option value="status_asc">Status (A-Z)</option>
                            <option value="verdict_asc">Verdict (A-Z)</option>
                        </select>
                    </div>
                    <div class="sort-option">
                        <label>Secondary Sort:</label>
                        <select id="sort-by-2" class="form-select" onchange="applyFilters('interviews')">
                            <option value="">None</option>
                            <option value="student_name_asc">Student Name (A-Z)</option>
                            <option value="student_name_desc">Student Name (Z-A)</option>
                            <option value="created_at_desc">Date (Newest First)</option>
                            <option value="created_at_asc">Date (Oldest First)</option>
                            <option value="duration_desc">Duration (Longest First)</option>
                            <option value="duration_asc">Duration (Shortest First)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Group By Section -->
            <div class="group-by-section">
                <div class="filter-section-title">📋 Group By</div>
                <div class="group-by-options">
                    <div class="group-by-option">
                        <input type="radio" id="group-none" name="group-by" value="" onchange="applyFilters('interviews')" checked>
                        <label for="group-none">No Grouping</label>
                    </div>
                    <div class="group-by-option">
                        <input type="radio" id="group-status" name="group-by" value="status" onchange="applyFilters('interviews')">
                        <label for="group-status">Status</label>
                    </div>
                    <div class="group-by-option">
                        <input type="radio" id="group-verdict" name="group-by" value="verdict" onchange="applyFilters('interviews')">
                        <label for="group-verdict">Verdict</label>
                    </div>
                    <div class="group-by-option">
                        <input type="radio" id="group-date" name="group-by" value="date" onchange="applyFilters('interviews')">
                        <label for="group-date">Date</label>
                    </div>
                    <div class="group-by-option">
                        <input type="radio" id="group-duration" name="group-by" value="duration" onchange="applyFilters('interviews')">
                        <label for="group-duration">Duration Range</label>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="filter-actions">
                <button class="btn-filter" onclick="applyFilters('interviews', true)">Apply Filters</button>
                <button class="btn-clear" onclick="clearAllFilters()">Clear All</button>
                <button class="btn-export" onclick="exportInterviews()">Export CSV</button>
                <button class="btn btn-secondary" onclick="loadInterviews()">Refresh Data</button>
            </div>
        </div>
    </div>

    <!-- Question Filter Panel -->
    <div id="question-filter-panel" class="filter-panel">
        <div class="filter-panel-header">
            <h3>Question Filter Options</h3>
            <button class="close-btn" onclick="closeQuestionFilterPanel()">✕</button>
        </div>
        <div class="filter-panel-content">
            <!-- Search Section -->
            <div class="filter-section">
                <div class="filter-section-title">🔍 Search & Filter Questions</div>
                <div class="filter-row">
                    <div class="filter-group">
                        <label>Search:</label>
                        <input type="text" id="bank-search-input" class="form-input" placeholder="Search questions by text..." onkeyup="loadQuestions()">
                    </div>
                    <div class="filter-group">
                        <label>Category:</label>
                        <select id="bank-category-select" class="form-select" onchange="loadQuestions()">
                            <option value="">All Categories</option>
                            <option value="Favorites">My Favorites</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Sort by:</label>
                        <select id="question-sort-by" class="form-select" onchange="loadQuestions()">
                            <option value="popularity">Most Popular</option>
                            <option value="recent">Most Recent</option>
                            <option value="alphabetical">Alphabetical</option>
                            <option value="category">Category</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="filter-actions">
                <button class="btn-filter" onclick="loadQuestions()">Search Questions</button>
                <button class="btn-clear" onclick="clearQuestionFilters()">Clear Filters</button>
                <button class="btn-export" onclick="exportQuestions()">Export Questions</button>
            </div>
        </div>
    </div>

    <script>
        let allInterviews = [];
        let allQuestions = [];
        let favoriteQuestionIds = new Set();
        let currentUser = null;

        document.addEventListener('DOMContentLoaded', () => {
            checkUserLoginStatus();
        });

        async function checkUserLoginStatus() {
            // 1) Prefer URL params (first-time after OAuth redirect)
            const params = new URLSearchParams(window.location.search);
            const urlEmail = params.get('email');
            const urlName = params.get('name');
            const urlRole = params.get('role');
            if (urlEmail || urlName) {
                const userData = {
                    email: urlEmail || '',
                    name: urlName || (urlEmail ? urlEmail.split('@')[0] : 'User'),
                    role: urlRole || 'interviewer'
                };
                try { localStorage.setItem('bees_user_data', JSON.stringify(userData)); } catch {}
                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname + window.location.hash);
            }

            // 2) Load from storage
            const storedUserData = localStorage.getItem('bees_user_data');
            if (storedUserData) {
                try {
                    const userData = JSON.parse(storedUserData);
                    if (userData && (userData.email || userData.name)) {
                        // Avatar initial
                        try {
                            const userIdResponse = await fetch('/api/user/id');
                            const userIdData = await userIdResponse.json();
                            const userId = userIdData.success ? userIdData.userId : null;
                            const initial = userId ? String(userId).charAt(0).toUpperCase() : (userData.email || userData.name).charAt(0).toUpperCase();
                            document.getElementById('user-avatar').textContent = initial;
                        } catch (error) {
                            console.error('Error fetching user ID:', error);
                            document.getElementById('user-avatar').textContent = (userData.email || userData.name).charAt(0).toUpperCase();
                        }
                        const avatar = document.getElementById('user-avatar');
                        const menu = document.getElementById('avatar-menu');
                        avatar.onclick = ()=> { menu.style.display = (menu.style.display==='block'?'none':'block'); };
                        document.addEventListener('click', (e)=>{ if (!avatar.contains(e.target) && !menu.contains(e.target)) menu.style.display='none'; });
                        const logoutBtn = document.getElementById('logout-btn');
                        if (logoutBtn) {
                            logoutBtn.onclick = ()=> {
                                const overlay = document.createElement('div');
                                overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;z-index:2000;';
                                overlay.innerHTML = `
                                  <div style="background:#fff;border:1px solid #e5e7eb;border-radius:8px;min-width:280px;max-width:90%;padding:16px;box-shadow:0 10px 20px rgba(0,0,0,0.15)">
                                    <div style=\"font-weight:600;margin-bottom:8px;color:#111827\">Logout?</div>
                                    <div style=\"font-size:14px;color:#374151;margin-bottom:12px\">Are you sure you want to logout?</div>
                                    <div style=\"display:flex;gap:8px;justify-content:flex-end\">
                                      <button id=\"lg-cancel\" style=\"border:1px solid #e5e7eb;background:#fff;padding:6px 10px;border-radius:6px;cursor:pointer\">Cancel</button>
                                      <button id=\"lg-confirm\" style=\"background:#111827;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer\">Logout</button>
                                    </div>
                                  </div>`;
                                document.body.appendChild(overlay);
                                overlay.querySelector('#lg-cancel').onclick = ()=> overlay.remove();
                                overlay.querySelector('#lg-confirm').onclick = ()=> { overlay.remove(); try { localStorage.removeItem('bees_user_data'); } catch {}; window.location.href = '/'; };
                            };
                        }
                        currentUser = { name: userData.name || 'User', email: userData.email || '' };
                        await loadDashboardData();
                        return;
                    }
                } catch (e) {
                    console.error('Error parsing stored user data:', e);
                    // Do not remove storage blindly; allow retry path below
                }
            }

            // 3) If still no user, go home to sign in
            window.location.href = '/';
        }

        async function loadDashboardData() {
            try {
                await Promise.all([
                    loadMyInterviews(),
                    loadQuestions(),
                    loadFavoriteQuestions(),
                    loadStats()
                ]);
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        window.showSection = function(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.add('active');
            
            // Add active class to clicked nav link
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // If called programmatically, find the correct nav link
                document.querySelector(`[onclick="showSection('${sectionName}')"]`).classList.add('active');
            }
            
            // Update page title
            const titles = {
                'interviews': 'My Interviews',
                'questions': 'Question Analysis'
            };
            document.getElementById('page-title').textContent = titles[sectionName];

            // Update URL to persist tab state
            const url = new URL(window.location);
            url.searchParams.set('tab', sectionName);
            window.history.replaceState({}, '', url);
        }

        // Activate section from URL param, e.g., ?tab=my-interviews or ?tab=questions
        document.addEventListener('DOMContentLoaded', function() {
            const params = new URLSearchParams(window.location.search);
            const tab = params.get('tab');
            if (tab) {
                if (tab === 'my-interviews' || tab === 'interviews') {
                    showSection('interviews');
                } else if (tab === 'questions') {
                    showSection('questions');
                }
            }
        });

        // Filter Panel Functions
        let currentFilterTab = 'interviews'; // Default tab
        
        window.toggleFilterPanel = function(tab = 'interviews') {
            // Close all filter panels first
            document.querySelectorAll('.filter-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById('filter-panel-overlay').classList.remove('active');
            
            // Determine which panel to show
            let panelId = 'filter-panel';
            if (tab === 'questions') {
                panelId = 'question-filter-panel';
            }
            
            const panel = document.getElementById(panelId);
            const overlay = document.getElementById('filter-panel-overlay');
            
            if (panel && !panel.classList.contains('active')) {
                currentFilterTab = tab;
                generateFilterContent(tab);
                panel.classList.add('active');
                overlay.classList.add('active');
            }
        }

        function generateFilterContent(tab) {
            // Determine which panel content to update
            let content;
            if (tab === 'questions') {
                content = document.querySelector('#question-filter-panel .filter-panel-content');
            } else {
                content = document.querySelector('#filter-panel .filter-panel-content');
            }
            
            const titles = {
                'interviews': 'My Interviews',
                'questions': 'Question Analysis'
            };
            
            content.innerHTML = `
                <div class="filter-section">
                    <div class="filter-section-title">🔍 Search & Filter</div>
                    <div class="filter-row">
                        ${generateFilterFields(tab)}
                    </div>
                </div>
                
                <div class="sort-section">
                    <div class="filter-section-title">📊 Sort Options</div>
                    <div class="sort-options">
                        ${generateSortOptions(tab)}
                    </div>
                </div>
                
                <div class="group-by-section">
                    <div class="filter-section-title">📋 Group By</div>
                    <div class="group-by-options">
                        ${generateGroupByOptions(tab)}
                    </div>
                </div>
                
                <div class="filter-actions">
                    <button class="btn-filter" onclick="applyFilters('${tab}', true)">Apply Filters</button>
                    <button class="btn-clear" onclick="clearAllFilters('${tab}')">Clear All</button>
                    <button class="btn-export" onclick="exportData('${tab}')">Export Data</button>
                </div>
            `;
        }

        function generateFilterFields(tab) {
            const filterConfigs = {
                'interviews': `
                    <div class="filter-group">
                        <label>Search:</label>
                        <input type="text" id="search-interviews" class="form-input" placeholder="Search by student name, email, or Zeta ID...">
                    </div>
                    <div class="filter-group">
                        <label>Status:</label>
                        <select id="status-filter" class="form-select">
                            <option value="">All Statuses</option>
                            <option value="completed">Completed</option>
                            <option value="in_progress">In Progress</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Verdict:</label>
                        <select id="verdict-filter" class="form-select">
                            <option value="">All Verdicts</option>
                            <option value="Tiger">Tiger</option>
                            <option value="Cow">Cow</option>
                            <option value="Cow+">Cow+</option>
                            <option value="Sheep">Sheep</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Session:</label>
                        <select id="session-filter" class="form-select">
                            <option value="">All Sessions</option>
                            ${[...new Set((interviews || []).map(i => i.session_name).filter(Boolean))].map(name => `<option value="${name}">${name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Date From:</label>
                        <input type="date" id="date-from" class="form-input">
                    </div>
                    <div class="filter-group">
                        <label>Date To:</label>
                        <input type="date" id="date-to" class="form-input">
                    </div>
                `,
                'questions': `
                    <div class="filter-group">
                        <label>Search:</label>
                        <input type="text" id="search-questions" class="form-input" placeholder="Search by question text...">
                    </div>
                    <div class="filter-group">
                        <label>Category:</label>
                        <select id="category-filter" class="form-select">
                            <option value="">All Categories</option>
                            <option value="Technical">Technical</option>
                            <option value="General">General</option>
                            <option value="Behavioral">Behavioral</option>
                            <option value="English">English</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Times Asked:</label>
                        <input type="number" id="times-asked-min" class="form-input" placeholder="Min" min="0">
                    </div>
                    <div class="filter-group">
                        <label>Success Rate:</label>
                        <input type="number" id="success-rate-min" class="form-input" placeholder="Min %" min="0" max="100">
                    </div>
                `
            };
            
            return filterConfigs[tab] || '';
        }

        function generateSortOptions(tab) {
            const sortConfigs = {
                'interviews': `
                    <div class="sort-option">
                        <label>Sort by:</label>
                        <select id="sort-by" class="form-select" onchange="applyFilters('interviews')">
                            <option value="created_at_desc">Date (Newest First)</option>
                            <option value="created_at_asc">Date (Oldest First)</option>
                            <option value="student_name_asc">Student Name (A-Z)</option>
                            <option value="student_name_desc">Student Name (Z-A)</option>
                            <option value="student_email_asc">Student Email (A-Z)</option>
                            <option value="student_email_desc">Student Email (Z-A)</option>
                            <option value="zeta_id_asc">Zeta ID (A-Z)</option>
                            <option value="zeta_id_desc">Zeta ID (Z-A)</option>
                            <option value="status_asc">Status (A-Z)</option>
                            <option value="status_desc">Status (Z-A)</option>
                            <option value="verdict_asc">Verdict (A-Z)</option>
                            <option value="verdict_desc">Verdict (Z-A)</option>
                        </select>
                    </div>
                `,
                'questions': `
                    <div class="sort-option">
                        <label>Sort by:</label>
                        <select id="sort-by" class="form-select" onchange="applyFilters('questions')">
                            <option value="question_text_asc">Question (A-Z)</option>
                            <option value="question_text_desc">Question (Z-A)</option>
                            <option value="category_asc">Category (A-Z)</option>
                            <option value="category_desc">Category (Z-A)</option>
                            <option value="times_asked_desc">Times Asked (Most)</option>
                            <option value="times_asked_asc">Times Asked (Least)</option>
                            <option value="times_answered_correctly_desc">Correct Answers (Most)</option>
                            <option value="times_answered_correctly_asc">Correct Answers (Least)</option>
                            <option value="times_answered_incorrectly_desc">Incorrect Answers (Most)</option>
                            <option value="times_answered_incorrectly_asc">Incorrect Answers (Least)</option>
                            <option value="success_rate_desc">Success Rate (Highest)</option>
                            <option value="success_rate_asc">Success Rate (Lowest)</option>
                            <option value="created_at_desc">Date Added (Newest)</option>
                            <option value="created_at_asc">Date Added (Oldest)</option>
                        </select>
                    </div>
                `
            };
            
            return sortConfigs[tab] || '';
        }

        function generateGroupByOptions(tab) {
            const groupConfigs = {
                'interviews': `
                    <div class="group-by-option">
                        <input type="radio" id="group-none" name="group-by" value="" checked onchange="applyFilters('interviews')">
                        <label for="group-none">No Grouping</label>
                    </div>
                    <div class="group-by-option">
                        <input type="radio" id="group-status" name="group-by" value="status" onchange="applyFilters('interviews')">
                        <label for="group-status">By Status</label>
                    </div>
                    <div class="group-by-option">
                        <input type="radio" id="group-verdict" name="group-by" value="verdict" onchange="applyFilters('interviews')">
                        <label for="group-verdict">By Verdict</label>
                    </div>
                    <div class="group-by-option">
                        <input type="radio" id="group-date" name="group-by" value="created_date" onchange="applyFilters('interviews')">
                        <label for="group-date">By Date</label>
                    </div>
                `,
                'questions': `
                    <div class="group-by-option">
                        <input type="radio" id="group-none" name="group-by" value="" checked onchange="applyFilters('questions')">
                        <label for="group-none">No Grouping</label>
                    </div>
                    <div class="group-by-option">
                        <input type="radio" id="group-category" name="group-by" value="category" onchange="applyFilters('questions')">
                        <label for="group-category">By Category</label>
                    </div>
                    <div class="group-by-option">
                        <input type="radio" id="group-times-asked" name="group-by" value="times_asked" onchange="applyFilters('questions')">
                        <label for="group-times-asked">By Times Asked</label>
                    </div>
                `
            };
            
            return groupConfigs[tab] || '';
        }

        function closeFilterPanel() {
            document.querySelectorAll('.filter-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById('filter-panel-overlay').classList.remove('active');
        }

        function closeQuestionFilterPanel() {
            document.getElementById('question-filter-panel').classList.remove('active');
            document.getElementById('filter-panel-overlay').classList.remove('active');
        }

        // NEW UNIFIED FILTER SYSTEM
        function applyUnifiedFilters(tab, data) {
            console.log(`Applying unified filters for tab: ${tab}`);
            
            if (!data || !Array.isArray(data)) {
                console.warn('No data provided for filtering');
                return [];
            }
            
            let filtered = [...data];
            
            // Get filter values safely
            const getFilterValue = (id) => {
                const element = document.getElementById(id);
                return element ? element.value : '';
            };
            
            const getRadioValue = (name) => {
                const element = document.querySelector(`input[name="${name}"]:checked`);
                return element ? element.value : '';
            };
            
            switch(tab) {
                case 'interviews':
                    // Search filter
                    const searchTerm = getFilterValue('search-interviews');
                    if (searchTerm) {
                        filtered = filtered.filter(i => 
                            (i.student_name && i.student_name.toLowerCase().includes(searchTerm.toLowerCase())) ||
                            (i.student_email && i.student_email.toLowerCase().includes(searchTerm.toLowerCase())) ||
                            (i.zeta_id && i.zeta_id.toLowerCase().includes(searchTerm.toLowerCase()))
                        );
                    }
                    
                    // Status filter
                    const status = getFilterValue('status-filter');
                    if (status) {
                        filtered = filtered.filter(i => i.status === status);
                    }
                    
                    // Verdict filter
                    const verdict = getFilterValue('ver